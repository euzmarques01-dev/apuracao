<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>TSE â€“ Painel Eleitoral</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#f4f6f8}
header{background:#0b5ed7;color:#fff;padding:12px}
button{cursor:pointer}
.card{background:#fff;margin:16px;padding:16px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.1)}
.barra{height:16px;background:#ddd;border-radius:10px;overflow:hidden}
.barra span{display:block;height:100%;background:#0b5ed7}
.estados{display:grid;grid-template-columns:repeat(auto-fill,90px);gap:10px}
.estado{background:#dee2e6;padding:8px;border-radius:10px;text-align:center;font-weight:bold;cursor:pointer}
.candidato{margin:8px 0}
.eleito{color:#00c853;font-weight:bold}
.segundo{color:#ff9800;font-weight:bold}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;justify-content:center;align-items:center}
.box{background:#fff;padding:16px;border-radius:12px;width:420px;max-height:90vh;overflow:auto}
input,select{width:100%;margin:6px 0;padding:6px}
</style>
</head>

<body>

<header>
  <strong>TSE â€“ RESULTADOS</strong>
  <button onclick="login()" style="float:right">Fundador</button>
</header>

<div class="card">
  <h2>ApuraÃ§Ã£o Nacional â€“ Presidente</h2>
  <div class="barra"><span id="barraBrasil"></span></div>
  <p>Urnas: <span id="pctBrasil">0%</span></p>
  <p>Brancos: <span id="brancoBrasil">0</span> | Nulos: <span id="nuloBrasil">0</span></p>
  <div id="listaPresidente"></div>
</div>

<div class="card">
  <h3>Estados</h3>
  <div class="estados" id="estados"></div>
</div>

<div class="modal" id="painel">
<div class="box">
<h3>Painel do Fundador</h3>

<select id="estadoSel"></select>

<label>Urnas (%)</label>
<input type="range" min="0" max="100" id="pctUrna">

<input type="number" id="branco" placeholder="Brancos">
<input type="number" id="nulo" placeholder="Nulos">

<button onclick="aplicarEstado()">Aplicar Estado</button>
<hr>

<select id="cargo">
<option>Presidente</option>
<option>Governador</option>
<option>Senador</option>
<option>Deputado</option>
</select>

<input id="nome" placeholder="Nome do candidato">
<input id="partido" placeholder="Partido">
<input type="number" id="votos" placeholder="Total de votos">

<button onclick="addCandidato()">Adicionar Candidato</button>
<button onclick="fechar()">Fechar</button>
</div>
</div>

<script type="module">
/* ðŸ”¥ FIREBASE */
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAE-c6y2Z1JsQplCfj1UNW7Wyr4ssCsJQU",
  authDomain: "tse-painel.firebaseapp.com",
  databaseURL: "https://tse-painel-default-rtdb.firebaseio.com",
  projectId: "tse-painel",
  storageBucket: "tse-painel.firebasestorage.app",
  messagingSenderId: "818733405394",
  appId: "1:818733405394:web:8e3e3e45062e3122e9490b"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ðŸ§  DADOS */
const UFs=["AC","AL","AP","AM","BA","CE","DF","ES","GO","MA","MT","MS","MG","PA","PB","PR","PE","PI","RJ","RN","RS","RO","RR","SC","SP","SE","TO"];
let fundador=false, estadoAtual=null;

let dados={
  estados:{},
  presidente:[]
};

UFs.forEach(uf=>{
  dados.estados[uf]={pct:0,branco:0,nulo:0,cargos:{Governador:[],Senador:[],Deputado:[]}};
});

/* ðŸ“¡ CARREGA AUTOMÃTICO */
onValue(ref(db,"eleicao"),snap=>{
  if(snap.exists()){
    dados=snap.val();
    render();
  }
});

/* ðŸ’¾ SALVAR */
function salvar(){ set(ref(db,"eleicao"),dados); }

/* UI */
const estadosDiv=document.getElementById("estados");
const estadoSel=document.getElementById("estadoSel");
UFs.forEach(uf=>{
  estadosDiv.innerHTML+=`<div class="estado" onclick="abrirEstado('${uf}')">${uf}<br><small>0%</small></div>`;
  estadoSel.innerHTML+=`<option>${uf}</option>`;
});

window.login=()=>{ if(prompt("Senha")==="2007"){fundador=true;alert("Modo fundador ativo");} }
window.fechar=()=>painel.style.display="none";
window.abrirEstado=uf=>{ if(!fundador)return; estadoAtual=uf; painel.style.display="flex"; };

window.aplicarEstado=()=>{
  const e=dados.estados[estadoAtual];
  e.pct=+pctUrna.value;
  e.branco=+branco.value||0;
  e.nulo=+nulo.value||0;
  salvar();
};

window.addCandidato=()=>{
  const obj={nome:nome.value,partido:partido.value,votos:+votos.value,votosAtual:0,status:""};
  if(cargo.value==="Presidente") dados.presidente.push(obj);
  else dados.estados[estadoSel.value].cargos[cargo.value].push(obj);
  salvar();
};

function render(){
  let soma=0,b=0,n=0;
  UFs.forEach((uf,i)=>{
    soma+=dados.estados[uf].pct;
    b+=dados.estados[uf].branco;
    n+=dados.estados[uf].nulo;
    estadosDiv.children[i].querySelector("small").textContent=dados.estados[uf].pct+"%";
  });
  barraBrasil.style.width=(soma/UFs.length)+"%";
  pctBrasil.textContent=(soma/UFs.length).toFixed(1)+"%";
  brancoBrasil.textContent=b;
  nuloBrasil.textContent=n;

  listaPresidente.innerHTML="";
  dados.presidente.forEach(p=>{
    listaPresidente.innerHTML+=`<div class="candidato"><strong>${p.nome}</strong> (${p.partido})</div>`;
  });
}
</script>
</body>
</html>
