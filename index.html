<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel Eleitoral – TSE</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

<style>
:root{
  --azul:#0b5ed7;
  --verde:#00c853;
  --amarelo:#ffd600;
  --vermelho:#d50000;
}
*{box-sizing:border-box;font-family:Roboto;margin:0;padding:0}
body{background:#f4f6f8}
header{
  background:var(--azul);
  color:#fff;
  padding:12px 16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
header button{
  background:#fff;
  border:none;
  padding:4px 10px;
  border-radius:20px;
  font-weight:700;
  font-size:12px;
  cursor:pointer;
}
main{padding:16px}
.card{
  background:#fff;
  border-radius:14px;
  padding:16px;
  margin-bottom:16px;
  box-shadow:0 6px 16px rgba(0,0,0,.08);
}
.barra{
  height:18px;
  background:#ddd;
  border-radius:20px;
  overflow:hidden;
  margin:6px 0;
}
.barra span{
  display:block;
  height:100%;
  background:linear-gradient(90deg,#0b5ed7,#3d8bfd);
}
.estados{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(110px,1fr));
  gap:10px;
}
.estado{
  background:#dee2e6;
  border-radius:12px;
  padding:8px;
  text-align:center;
  font-weight:700;
  cursor:pointer;
}
.estado-info{
  font-size:11px;
  margin-top:6px;
  font-weight:500;
}
.candidato{margin-bottom:12px}
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:999;
}
.modal .box{
  background:#fff;
  width:460px;
  max-height:90vh;
  overflow:auto;
  border-radius:14px;
  padding:16px;
}
input,select,button{width:100%;padding:8px;margin-bottom:8px}
.btn-fechar-estado{
  background:var(--vermelho);
  color:#fff;
  border:none;
  padding:6px;
  border-radius:8px;
  font-weight:700;
}
.eleito{animation:pisca 1s infinite}
@keyframes pisca{
  0%{color:#000}
  50%{color:#00c853}
  100%{color:#000}
}
</style>
</head>

<body>

<header>
  <strong>TSE – NAÇÃO BRASILEIRA</strong>
  <button onclick="login()">Painel Fundador</button>
</header>

<main>

<div class="card">
  <h2>Apuração Nacional – Presidente</h2>
  <div class="barra"><span id="barraGeral"></span></div>
  <p>Urnas: <strong id="pctGeral">0%</strong></p>
  <p>Brancos: <span id="brancoGeral">0</span> | Nulos: <span id="nuloGeral">0</span></p>
</div>

<div class="card">
  <div id="fecharEstadoArea"></div>
  <h2 id="tituloCargo">Presidente – Nacional</h2>
  <div id="listaCandidatos"></div>
</div>

<div class="card">
  <h2>Estados + Exterior</h2>
  <div class="estados" id="estados"></div>
</div>

</main>

<div class="modal" id="painel">
  <div class="box">
    <h3>Painel do Fundador</h3>

    <select id="estadoSel"></select>
    <input type="range" min="0" max="100" id="pctUrna">
    <small>Urnas: <span id="pctLabel">0%</span></small>

    <input type="number" id="pctBranco" placeholder="Brancos">
    <input type="number" id="pctNulo" placeholder="Nulos">
    <input type="color" id="corEstado">

    <button onclick="aplicarEstado()">Aplicar Estado</button>
    <hr>

    <select id="cargoSel">
      <option>Presidente</option>
      <option>Governador</option>
      <option>Senador</option>
      <option>Deputado</option>
      <option>Prefeito</option>
      <option>Vereador</option>
    </select>

    <input id="nome" placeholder="Nome">
    <input id="partido" placeholder="Partido">
    <input type="number" id="totalVotos" placeholder="Total de votos">

    <button onclick="addCandidato()">Adicionar Candidato</button>
    <button onclick="painel.style.display='none'">Fechar</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, set, onValue, push } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAE-c6y2Z1JsQplCfj1UNW7Wyr4ssCsJQU",
  authDomain: "tse-painel.firebaseapp.com",
  databaseURL: "https://tse-painel-default-rtdb.firebaseio.com",
  projectId: "tse-painel",
  storageBucket: "tse-painel.firebasestorage.app",
  messagingSenderId: "818733405394",
  appId: "1:818733405394:web:8e3e3e45062e3122e9490b",
  measurementId: "G-49XLVVE7D5"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const estadosLista=["AC","AL","AP","AM","BA","CE","DF","ES","GO","MA","MT","MS","MG","PA","PB","PR","PE","PI","RJ","RN","RS","RO","RR","SC","SP","SE","TO","EXTERIOR"];

let estadoAtual="BR";
let cargoAtual="Presidente";
let dados={}, candidatos={};

const estadosDiv=document.getElementById("estados");
const estadoSel=document.getElementById("estadoSel");
const pctUrna=document.getElementById("pctUrna");
const pctLabel=document.getElementById("pctLabel");

estadosLista.forEach(uf=>{
  estadosDiv.innerHTML+=`
    <div class="estado" id="${uf}">
      ${uf}
      <div class="estado-info"></div>
    </div>`;
  estadoSel.innerHTML+=`<option>${uf}</option>`;
});

document.querySelectorAll(".estado").forEach(el=>{
  el.addEventListener("click",()=>{
    estadoAtual=el.id;
    render();
  });
});

onValue(ref(db,"dados"),snap=>{
  dados=snap.val()||{};
  atualizarGeral();
});

onValue(ref(db,"candidatos"),snap=>{
  candidatos=snap.val()||{};
  render();
});

window.login=()=>prompt("Senha do fundador")==="2007"&&(painel.style.display="flex");

pctUrna.oninput=()=>pctLabel.textContent=pctUrna.value+"%";

window.aplicarEstado=()=>{
  const e=estadoSel.value;
  set(ref(db,"dados/"+e),{
    pct:+pctUrna.value,
    branco:+pctBranco.value||0,
    nulo:+pctNulo.value||0,
    cor:corEstado.value
  });
};

function atualizarGeral(){
  let s=0,b=0,n=0;
  estadosLista.forEach(e=>{
    if(dados[e]){
      s+=dados[e].pct||0;
      b+=dados[e].branco||0;
      n+=dados[e].nulo||0;
    }
  });
  const pct=s/estadosLista.length;
  barraGeral.style.width=pct+"%";
  pctGeral.textContent=pct.toFixed(1)+"%";
  brancoGeral.textContent=b;
  nuloGeral.textContent=n;
}

window.addCandidato=()=>{
  const cargo=cargoSel.value;
  const estado=cargo==="Presidente"?"BR":estadoSel.value;
  push(ref(db,"candidatos/"+cargo+"/"+estado),{
    nome:nome.value,
    partido:partido.value,
    votosFinal:+totalVotos.value,
    votosAtual:0,
    pct:0,
    status:""
  });
  nome.value=partido.value=totalVotos.value="";
};

window.fecharEstado=()=>{estadoAtual="BR";render();};

function render(){
  listaCandidatos.innerHTML="";
  fecharEstadoArea.innerHTML=estadoAtual!=="BR"
    ? `<button class="btn-fechar-estado" onclick="fecharEstado()">Fechar ${estadoAtual}</button>`:"";

  tituloCargo.textContent=cargoAtual+" – "+(estadoAtual==="BR"?"Nacional":estadoAtual);

  const lista=candidatos[cargoAtual]?.[estadoAtual]||{};
  Object.values(lista).forEach(c=>{
    listaCandidatos.innerHTML+=`
      <div class="candidato">
        <strong>${c.nome}</strong> (${c.partido})
        <div class="barra"><span style="width:${c.pct||0}%"></span></div>
      </div>`;
  });

  estadosLista.forEach(uf=>{
    const info=document.querySelector(`#${uf} .estado-info`);
    info.innerHTML="";
    const listaUF=candidatos[cargoAtual]?.[uf];
    if(!listaUF) return;
    const lider=Object.values(listaUF).sort((a,b)=>b.votosFinal-a.votosFinal)[0];
    if(lider) info.innerHTML=`${lider.nome} (${lider.partido})`;
  });
}
</script>

</body>
</html>
